---
title: "DataCleanFibre"
author: "mia"
date: "2024-09-27"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(here)      
library(readxl)    
library(janitor)   
library(stringr)   
library(tidyr)     
library(dplyr)
library(knitr)
```

```{r}
raw_bp <- read.csv(here("ZIPallFiles","AHSnpa11bp.csv"), header=TRUE)
raw_bb <- read.csv(here("ZIPallFiles","AHSnpa11bb.csv"), header=TRUE)
bp_bb <- inner_join(raw_bp, raw_bb, by = "ABSPID")

raw_bsp <- read.csv(here("ZIPallFiles","inp13bsp.csv"), header=TRUE)
raw_bcn <- read.csv(here("ZIPallFiles","inp13bcn.csv"), header=TRUE)
raw_bhh <- read.csv(here("ZIPallFiles","inp13bhh.csv"), header=TRUE)
bsp_bcn <- inner_join(raw_bsp, raw_bcn, by = "ABSHID")
bsp_bcn_bhh <- inner_join(bsp_bcn,raw_bhh,by="ABSHID")
bsp_bcn_bhh <- bsp_bcn_bhh %>%
  rename(ABSPID = ABSHID,AGEC =AGEEC)
```

```{r}
Data1 <- bp_bb %>%
  select(
    ABSPID, HYPBC,
    AGEC, SEX, BMISC, SYSTOL, DIASTOL,
    POTAST1, POTAST2, SODIUMT1, SODIUMT2,
    PHDKGWBC,PHDCMHBC,
    EXREGUIC, EXREGUID,DURACSF,DURSACSF,
    ENERGYT1, ENERGYF1, ENERGYT2, ENERGYF2, 
    ENRGYT1, ENRGYF1, ENRGYT2, ENRGYF2, 
    FIBRET1, FIBREF1, SABDYMS,  
    FIBRET2, FIBREF2, SF2SA1QN
  ) %>%
  rename(SOCIAL = SF2SA1QN) %>%
  mutate(
    HYPBC = as.factor(HYPBC),
    SEX = as.factor(SEX),
    SOCIAL = as.factor(SOCIAL),
    BMISC = na_if(na_if(BMISC, 99), 98),
    SYSTOL = na_if(na_if(na_if(SYSTOL,0),998),999),
    DIASTOL = na_if(na_if(na_if(DIASTOL,0),998),999),
    POTAST = (POTAST1 + POTAST2) / 2, 
    SODIUMT = (SODIUMT1 + SODIUMT2) / 2,
    ENERGYT = (ENERGYT1 + ENERGYT2) / 2,
    ENRGYT = (ENRGYT1 + ENRGYT2) / 2,
    FIBRET = (FIBRET1 + FIBRET2) / 2
    ) %>%
  mutate(
    FIBRETP = (ENERGYT - ENRGYT) / ENERGYT * 100
  ) %>%
  filter(AGEC >= 18, HYPBC == 5) %>%
  select(ABSPID, HYPBC, 
         SOCIAL,
         AGEC, SEX, BMISC, 
         SYSTOL, DIASTOL, 
         POTAST, SODIUMT,
         FIBRETP)

summary(Data1)
```

```{r}
Data2 <- bsp_bcn_bhh %>%
  select(
    ABSPID,
    AGEC, SEX, BMISC, SYSTOL, DIASTOL,
    POTAST1, POTAST2, SODIUMT1, SODIUMT2,
    EXREGUIC, EXREGUID,DURACSF,DURSACSF,
    ENERGYT1, ENERGYF1, ENERGYT2, ENERGYF2, 
    ENRGYT1, ENRGYF1, ENRGYT2, ENRGYF2, 
    FIBRET1, FIBREF1, SABDYMS,  
    FIBRET2, FIBREF2,
    ICD10ME,SF2SA1DB
  ) %>%
  rename(SOCIAL = SF2SA1DB) %>%
  mutate(
    ICD10ME = as.factor(ICD10ME),
    SEX = as.factor(SEX),
    SOCIAL = as.factor(SOCIAL),
    BMISC = na_if(na_if(BMISC, 99), 98),
    SYSTOL = na_if(na_if(na_if(SYSTOL,0),998),999),
    DIASTOL = na_if(na_if(na_if(DIASTOL,0),998),999),
    POTAST = (POTAST1 + POTAST2) / 2, 
    SODIUMT = (SODIUMT1 + SODIUMT2) / 2,
    ENERGYT = (ENERGYT1 + ENERGYT2) / 2,
    ENRGYT = (ENRGYT1 + ENRGYT2) / 2,
    FIBRET = (FIBRET1 + FIBRET2) / 2
    ) %>%
  mutate(
    FIBRETP = (ENERGYT - ENRGYT) / ENERGYT * 100
    ) %>%
  filter(AGEC >= 18, !ICD10ME %in% c(7, 20)) %>%
  select(ABSPID,
         SOCIAL,
         AGEC, SEX, BMISC, 
         SYSTOL, DIASTOL, 
         POTAST, SODIUMT,
         FIBRETP)

summary(Data2)
```
